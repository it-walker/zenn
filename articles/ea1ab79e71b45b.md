---
title: "Amplify 4"
emoji: "ğŸ·"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["AWS", "Handson", "Amplify"]
published: false
---

## 04 AWS Amplify ã®ãƒãƒ³ã‚ºã‚ªãƒ³ï¼ˆFE/API/DB ç·¨ï¼‰

`GraphQL API`ã‚’è¿½åŠ ã—ã€è‡ªå‹•çš„ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒ—ãƒ­ãƒ“ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°ã—ã¾ã™ã€‚
ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯å‰å›ã®`react-amplified`ã§ã™ã€‚

```
amplify add api
```

ä»Šå›ã¯`GraphQL`ã‚’é¸æŠã—ã¾ã™ã€‚ãã®ã¾ã¾`Enter`ã‚’æŠ¼ã—ã¾ã™ã€‚

```
? Select from one of the below mentioned services: (Use arrow keys)
â¯ GraphQL
  REST
```

ä¸‹è¨˜ã®éƒ¨åˆ†ã¯ãã®ã¾ã¾`Enter`ã‚’æŠ¼ã—ã¾ã™ã€‚

```
? Here is the GraphQL API that we will create. Select a setting to edit or continue (Use arrow keys)
  Name: reactamplified
  Authorization modes: API key (default, expiration time: 7 days from now)
  Conflict detection (required for DataStore): Disabled
â¯ Continue
```

ã‚¹ã‚­ãƒ¼ãƒã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã¤ã„ã¦ã‚‚ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®`Single object with fileds`ã§é€²ã‚ã¾ã™ã€‚`Enter`ã‚’æŠ¼ã—ã¾ã™ã€‚

```
? Here is the GraphQL API that we will create. Select a setting to edit or continue Continue
? Choose a schema template: (Use arrow keys)
â¯ Single object with fields (e.g., â€œTodoâ€ with ID, name, description)
  One-to-many relationship (e.g., â€œBlogsâ€ with â€œPostsâ€ and â€œCommentsâ€)
  Blank Schema
```

ã‚¹ã‚­ãƒ¼ãƒã‚’ä»Šå¤‰æ›´ã™ã‚‹ã‹ã‚’èã‹ã‚Œã¾ã™ãŒã€`n`ã‚’é¸æŠã—ã¾ã™ã€‚

```
âš ï¸  WARNING: your GraphQL API currently allows public create, read, update, and delete access to all models via an API Key. To configure PRODUCTION-READY authorization rules, review: https://docs.amplify.aws/cli/graphql/authorization-rules

âœ… GraphQL schema compiled successfully.

Edit your schema at /home/ec2-user/environment/react-amplified/amplify/backend/api/reactamplified/schema.graphql or place .graphql files in a directory at /home/ec2-user/environment/react-amplified/amplify/backend/api/reactamplified/schema
? Do you want to edit the schema now? (Y/n) â€£
```

```
âœ” Do you want to edit the schema now? (Y/n) Â· no
âœ… Successfully added resource reactamplified locally

âœ… Some next steps:
"amplify push" will build all your local backend resources and provision it in the cloud
"amplify publish" will build all your local backend and frontend resources (if you have hosting category added) and provision it in the cloud
```

ã“ã“ã§è¨­å®šã‚’ç¢ºèªã™ã‚‹ãŸã‚ã«ã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
amplify status
```

```
$ amplify status

    Current Environment: dev

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Category â”‚ Resource name  â”‚ Operation â”‚ Provider plugin   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Api      â”‚ reactamplified â”‚ Create    â”‚ awscloudformation â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

GraphQL transformer version: 2
```

`Operation`ãŒ`Create`ã¨ã„ã†ã®ã¯`ä½œæˆå¾…ã¡`ã¨ã„ã†çŠ¶æ…‹ãªã®ã§ã€ã¾ã  Amplify ä¸Šã«åæ˜ ã•ã‚Œã¦ã„ãªã„ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚

å®Ÿéš›ã«åæ˜ ã•ã›ã‚‹ãŸã‚ã«ã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
amplify push
```

é€”ä¸­ã§èã‹ã‚Œã‚‹ã¨ã“ã‚ã¯`Y`ã‚’é¸æŠã—ã¾ã™ã€‚

```
$ amplify push
â § Building resource api/reactamplified
âš ï¸  WARNING: your GraphQL API currently allows public create, read, update, and delete access to all models via an API Key. To configure PRODUCTION-READY authorization rules, review: https://docs.amplify.aws/cli/graphql/authorization-rules

âœ… GraphQL schema compiled successfully.

Edit your schema at /home/ec2-user/environment/react-amplified/amplify/backend/api/reactamplified/schema.graphql or place .graphql files in a directory at /home/ec2-user/environment/react-amplified/amplify/backend/api/reactamplified/schema
âœ” Successfully pulled backend environment dev from the cloud.
â ¦ Building resource api/reactamplified
âš ï¸  WARNING: your GraphQL API currently allows public create, read, update, and delete access to all models via an API Key. To configure PRODUCTION-READY authorization rules, review: https://docs.amplify.aws/cli/graphql/authorization-rules

âœ… GraphQL schema compiled successfully.

Edit your schema at /home/ec2-user/environment/react-amplified/amplify/backend/api/reactamplified/schema.graphql or place .graphql files in a directory at /home/ec2-user/environment/react-amplified/amplify/backend/api/reactamplified/schema

    Current Environment: dev

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Category â”‚ Resource name  â”‚ Operation â”‚ Provider plugin   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Api      â”‚ reactamplified â”‚ Create    â”‚ awscloudformation â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âœ” Are you sure you want to continue? (Y/n) Â· yes

âš ï¸  WARNING: your GraphQL API currently allows public create, read, update, and delete access to all models via an API Key. To configure PRODUCTION-READY authorization rules, review: https://docs.amplify.aws/cli/graphql/authorization-rules

âœ… GraphQL schema compiled successfully.

Edit your schema at /home/ec2-user/environment/react-amplified/amplify/backend/api/reactamplified/schema.graphql or place .graphql files in a directory at /home/ec2-user/environment/react-amplified/amplify/backend/api/reactamplified/schema
â § Building resource api/reactamplified
âš ï¸  WARNING: your GraphQL API currently allows public create, read, update, and delete access to all models via an API Key. To configure PRODUCTION-READY authorization rules, review: https://docs.amplify.aws/cli/graphql/authorization-rules

âœ… GraphQL schema compiled successfully.

Edit your schema at /home/ec2-user/environment/react-amplified/amplify/backend/api/reactamplified/schema.graphql or place .graphql files in a directory at /home/ec2-user/environment/react-amplified/amplify/backend/api/reactamplified/schema
? Do you want to generate code for your newly created GraphQL API Yes
? Choose the code generation language target typescript
? Enter the file name pattern of graphql queries, mutations and subscriptions src/graphql/**/*.ts
? Do you want to generate/update all possible GraphQL operations - queries, mutations and subscriptions Yes
? Enter maximum statement depth [increase from default if your schema is deeply nested] 2
? Enter the file name for the generated code src/API.ts

Deployment completed.
Deploying root stack reactamplified [ ====================-------------------- ] 1/2
        amplify-reactamplified-dev-40â€¦ AWS::CloudFormation::Stack     UPDATE_IN_PROGRESS             Sun Mar 19 2023 04:42:42â€¦
        apireactamplified              AWS::CloudFormation::Stack     CREATE_COMPLETE                Sun Mar 19 2023 04:46:20â€¦
Deployed api reactamplified [ ======================================== ] 6/6
        GraphQLAPI                     AWS::AppSync::GraphQLApi       CREATE_COMPLETE                Sun Mar 19 2023 04:42:56â€¦
        GraphQLAPIDefaultApiKey215A6Dâ€¦ AWS::AppSync::ApiKey           CREATE_COMPLETE                Sun Mar 19 2023 04:43:00â€¦
        GraphQLAPITransformerSchema3Câ€¦ AWS::AppSync::GraphQLSchema    CREATE_COMPLETE                Sun Mar 19 2023 04:44:02â€¦
        GraphQLAPINONEDS95A13CF0       AWS::AppSync::DataSource       CREATE_COMPLETE                Sun Mar 19 2023 04:43:00â€¦
        Todo                           AWS::CloudFormation::Stack     CREATE_COMPLETE                Sun Mar 19 2023 04:45:43â€¦
        CustomResourcesjson            AWS::CloudFormation::Stack     CREATE_IN_PROGRESS             Sun Mar 19 2023 04:45:45â€¦

âœ” Generated GraphQL operations successfully and saved at src/graphql
âœ” Code generated successfully and saved in file src/API.ts
Deployment state saved successfully.

GraphQL endpoint: https://73jvf2h6svdgfcn4462z52thpy.appsync-api.ap-northeast-2.amazonaws.com/graphql
GraphQL API KEY: da2-azemy2tpszevvgkgjufhlp6nxy

GraphQL transformer version: 2
```

æ¬¡ã¯`src/App.js`ã‚’é–‹ã„ã¦ä¸­èº«ã‚’ä¸‹è¨˜ã«ç½®ãæ›ãˆã¾ã™ã€‚

```
/* src/App.js */
import React, { useEffect, useState } from 'react'
import { Amplify, API, graphqlOperation } from 'aws-amplify'
import { createTodo } from './graphql/mutations'
import { listTodos } from './graphql/queries'

import awsExports from "./aws-exports";
Amplify.configure(awsExports);

const initialState = { name: '', description: '' }

const App = () => {
  const [formState, setFormState] = useState(initialState)
  const [todos, setTodos] = useState([])

  useEffect(() => {
    fetchTodos()
  }, [])

  function setInput(key, value) {
    setFormState({ ...formState, [key]: value })
  }

  async function fetchTodos() {
    try {
      const todoData = await API.graphql(graphqlOperation(listTodos))
      const todos = todoData.data.listTodos.items
      setTodos(todos)
    } catch (err) { console.log('error fetching todos') }
  }

  async function addTodo() {
    try {
      if (!formState.name || !formState.description) return
      const todo = { ...formState }
      setTodos([...todos, todo])
      setFormState(initialState)
      await API.graphql(graphqlOperation(createTodo, {input: todo}))
    } catch (err) {
      console.log('error creating todo:', err)
    }
  }

  return (
    <div style={styles.container}>
      <h2>Amplify Todos</h2>
      <input
        onChange={event => setInput('name', event.target.value)}
        style={styles.input}
        value={formState.name}
        placeholder="Name"
      />
      <input
        onChange={event => setInput('description', event.target.value)}
        style={styles.input}
        value={formState.description}
        placeholder="Description"
      />
      <button style={styles.button} onClick={addTodo}>Create Todo</button>
      {
        todos.map((todo, index) => (
          <div key={todo.id ? todo.id : index} style={styles.todo}>
            <p style={styles.todoName}>{todo.name}</p>
            <p style={styles.todoDescription}>{todo.description}</p>
          </div>
        ))
      }
    </div>
  )
}

const styles = {
  container: { width: 400, margin: '0 auto', display: 'flex', flexDirection: 'column', justifyContent: 'center', padding: 20 },
  todo: {  marginBottom: 15 },
  input: { border: 'none', backgroundColor: '#ddd', marginBottom: 10, padding: 8, fontSize: 18 },
  todoName: { fontSize: 20, fontWeight: 'bold' },
  todoDescription: { marginBottom: 0 },
  button: { backgroundColor: 'black', color: 'white', outline: 'none', fontSize: 18, padding: '12px 0px' }
}

export default App
```

ä¿å­˜ã—çµ‚ã‚ã£ãŸã‚‰ã€`npm start`ã§å‹•ä½œã‚’ç¢ºèªã—ã¦ã¿ã¾ã™ã€‚

```
npm start
```

ãªãœã‹ã†ã¾ãã„ã‹ãªãã¦ã€ã‚‚ã†ä¸€åº¦ä½œã‚Šç›´ã—ãŸã‚Šã€ä¸€ã‹ã‚‰ã‚„ã‚Šç›´ã—ãŸã‚Šã—ãŸã®ã§ã™ãŒã€æ›¸ãæ–¹ã®å•é¡Œã§ã—ãŸã€‚

`src/index.js`ã«è¿½åŠ ã—ãŸå†…å®¹ã‚’å…ˆé ­ã«è¿½åŠ ã—ãŸã®ã§ã™ãŒã€å…ˆé ­ã§ã¯ãªãã€import æ–‡ã®æœ€å¾Œã«è¿½åŠ ã™ã¹ãã§ã—ãŸã€‚
eslint ã§ import æ–‡ã‚ˆã‚Šå‰ã«å‡¦ç†ã‚’æ›¸ã„ã¦ã—ã¾ã£ã¦ã„ã‚‹çŠ¶æ…‹ã«ãªã£ã¦ã„ãŸã®ã§ã€æ€’ã‚‰ã‚Œã¦ã„ãŸã‚ˆã†ã§ã™ã€‚

ã“ã†ã™ã¹ãã ã£ãŸã€‚

```
ã€œ
import { Amplify } from 'aws-amplify';
import awsExports from './aws-exports';
Amplify.configure(awsExports);
```
